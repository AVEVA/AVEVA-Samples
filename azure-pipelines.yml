# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml


  
jobs:      

- job: SDSangJS

  pool:
    vmImage: 'Ubuntu-16.04'
    
  steps :
    - task: NodeTool@0 
      inputs:
        versionSpec: '8.x' # replace this value with the version that you need for your project

    # Download Secure File
    # Download a secure file to a temporary location on the build or release agent
    - task: DownloadSecureFile@1
      inputs:
        secureFile: prod_oidc.config.json

    # Download Secure File
    # Download a secure file to a temporary location on the build or release agent
    - task: DownloadSecureFile@1
      inputs:
        secureFile: prod_sdsconfig.json
        
    # Download Secure File
    # Download a secure file to a temporary location on the build or release agent
    - task: DownloadSecureFile@1
      inputs:
        secureFile: prod_cred.json


    # Copy Files  
    # Copy files from source folder to target folder using match patterns (The match patterns will only match file paths, not folder paths)
    - task: CopyFiles@2
      inputs:
        sourceFolder: $(Agent.TempDirectory)
        contents: prod_oidc.config.json
        targetFolder: '$(Build.SourcesDirectory)/ocs_samples/basic_samples/SDS/JavaScript/Angular/src/app/config/' 
        #cleanTargetFolder: false # Optional 
        overWrite: true # Optional
        #flattenFolders: false # Optional
      displayName: copy file 1
      

    # Copy Files 
    # Copy files from source folder to target folder using match patterns (The match patterns will only match file paths, not folder paths)
    - task: CopyFiles@2
      inputs:
        sourceFolder: $(Agent.TempDirectory)
        contents: prod_sdsconfig.json
        targetFolder: '$(Build.SourcesDirectory)/ocs_samples/basic_samples/SDS/JavaScript/Angular/src/app/config/' 
        #cleanTargetFolder: false # Optional 
        overWrite: true # Optional
        #flattenFolders: false # Optional
      displayName: copy file 2

    # Copy Files   ocs_samples\basic_samples\SDS\JavaScript\Angular\e2e\src\config.json
    # Copy files from source folder to target folder using match patterns (The match patterns will only match file paths, not folder paths)
    - task: CopyFiles@2
      inputs:
        sourceFolder: $(Agent.TempDirectory)
        contents: prod_cred.json
        targetFolder: '$(Build.SourcesDirectory)/ocs_samples/basic_samples/SDS/JavaScript/Angular/e2e/src/' 
        #cleanTargetFolder: false # Optional 
        overWrite: true # Optional
        #flattenFolders: false # Optional
      displayName: copy file 3

    - script: |
        mv prod_oidc.config.json oidc.config.json
      workingDirectory: '$(Build.SourcesDirectory)/ocs_samples/basic_samples/SDS/JavaScript/Angular/src/app/config/'
      displayName: 'rename config file'

    - script: |
        mv prod_sdsconfig.json sdsconfig.json
      workingDirectory: '$(Build.SourcesDirectory)/ocs_samples/basic_samples/SDS/JavaScript/Angular/src/app/config/'
      displayName: 'rename config file2'

    - script: |
        mv prod_cred.json cred.json
      workingDirectory: '$(Build.SourcesDirectory)/ocs_samples/basic_samples/SDS/JavaScript/Angular/e2e/src/'
      displayName: 'rename config file3'
      
      
    - script: |
       npm install -g @angular/cli
      workingDirectory: $(Build.SourcesDirectory)/ocs_samples/basic_samples/SDS/JavaScript/Angular/
      displayName: 'Install tools1'      
      
      
    - script: |
       npx webdriver-manager update
      workingDirectory: $(Build.SourcesDirectory)/ocs_samples/basic_samples/SDS/JavaScript/Angular/
      displayName: 'Install tools2'    


    - script: |
       npm install 
      workingDirectory: $(Build.SourcesDirectory)/ocs_samples/basic_samples/SDS/JavaScript/Angular/
      displayName: 'Install tools3'   

    - script: |
       npm install protractor
       npx webdriver-manager update
       node node_modules\protractor\bin\webdriver-manager update

      workingDirectory: $(Build.SourcesDirectory)/ocs_samples/basic_samples/SDS/JavaScript/Angular/
      displayName: 'Install tools3'

    - script: |
        ng e2e
      displayName: 'Test that the app runs'
      workingDirectory: $(Build.SourcesDirectory)/ocs_samples/basic_samples/SDS/JavaScript/Angular/


