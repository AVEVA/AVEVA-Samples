# This template will perform a BinSkim with MicrosoftSecurityDevOps.
parameters:
- name: binskimPath
  type: string
  default: ""

steps:
# Create binskim folder
- powershell: |
    New-Item -ItemType Directory -Force -Path "$(Build.SourcesDirectory)\binskim"
  displayName: Create folder

# Copy files to-be-scanned from Build.SourcesDirectory folder into binskim folder
- task: CopyFiles@2
  displayName: Copy files into binskim
  inputs:
    SourceFolder: '$(Build.SourcesDirectory)'
    TargetFolder: '$(Pipeline.Workspace)\\binskim'
    ${{ if ne(parameters.binskimPath, '') }}:
      Contents: ${{ parameters.binskimPath }}
    ${{ else }}:
      Contents: |
        **/*.dll
        **/*.exe

# Run BinSkim Tool by MicrosoftSecurityDevOps for Target of above Task  folder "binskim"
- task: MicrosoftSecurityDevOps@1
  displayName: 'Run BinSkim'
  inputs:
    tools: 'BinSkim'
    break: true
  env:
    GDN_BINSKIM_TARGET: '$(Pipeline.Workspace)/binskim/**/*.*'
    GDN_BINSKIM_RECURSE: 'true'
    GDN_BINSKIM_VERBOSE: 'true'
